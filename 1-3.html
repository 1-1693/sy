<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>单词卡片</title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Arial", "Microsoft YaHei", sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f5f5f5;
            padding: 20px;
            -webkit-user-select: none;
            user-select: none;
        }

        .card {
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
            padding-top: 60px;
        }

        .toggle-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4285f4;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .toggle-btn:hover {
            background: #3367d6;
            transform: rotate(90deg);
        }

        .front {
            padding: 0 20px 20px;
            display: block;
        }

        .back {
            padding: 0 20px 20px;
            display: none;
        }

        .word-list {
            width: 20%;
            float: left;
            border-right: 1px solid #eee;
            padding-right: 15px;
            height: 500px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .word-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .word-item:hover {
            background: #e9ecef;
        }

        .sentence-area-front, .sentence-area-back {
            width: 78%;
            float: right;
            height: 500px;
            overflow-y: auto;
            padding: 0 10px;
            -webkit-overflow-scrolling: touch;
        }

        .sentence-area-front .dialog-sentence {
            margin: 15px 0;
            line-height: 1.6;
            cursor: pointer;
            transition: color 0.2s;
        }

        .sentence-area-front .dialog-sentence:hover {
            color: #4285f4;
        }

        .sentence-area-front .highlight-word {
            font-weight: 500;
            color: #2d3748;
            text-shadow: 0 0 1px rgba(0,0,0,0.05);
        }

        .sentence-area-back .sentence-pair {
            margin: 15px 0;
            line-height: 1.6;
        }

        .sentence-area-back .english {
            font-weight: 500;
            color: #2d3748;
            text-shadow: 0 0 1px rgba(0,0,0,0.05);
        }

        .sentence-area-back .chinese {
            color: #4a5568;
            margin-top: 5px;
            padding-left: 10px;
            border-left: 3px solid #4285f4;
        }

        .word-detail {
            clear: both;
            margin-top: 20px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            display: none;
        }

        .word-detail h3 {
            color: #2d3748;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .word-detail .phonetic {
            color: #718096;
            margin-bottom: 8px;
        }

        .word-detail .meanings {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .word-detail .pronounce-btn, .speech-controls .play-btn {
            padding: 6px 12px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            -webkit-tap-highlight-color: transparent;
        }

        .word-detail .pronounce-btn:hover, .speech-controls .play-btn:hover {
            background: #3367d6;
        }

        .speech-controls {
            clear: both;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .speech-controls label {
            font-weight: 600;
            color: #2d3748;
        }

        .speech-controls select, .speech-controls input {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            -webkit-appearance: none;
            appearance: none;
        }

        @media screen and (max-width: 1024px) {
            .word-list {
                width: 25%;
            }
            .sentence-area-front, .sentence-area-back {
                width: 73%;
            }
            .card {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <button class="toggle-btn" id="toggleBtn"><<i class="fa-solid fa-right-left"></</i></button>

        <div class="front clearfix" id="frontCard">
            <div class="word-list" id="wordList">
                <div class="word-item" data-word="peril">peril</div>
                <div class="word-item" data-word="accountable">accountable</div>
                <div class="word-item" data-word="organism">organism</div>
                <div class="word-item" data-word="journalism">journalism</div>
                <div class="word-item" data-word="citizen">citizen</div>
                <div class="word-item" data-word="civilization">civilization</div>
                <div class="word-item" data-word="campus">campus</div>
                <div class="word-item" data-word="aptitude">aptitude</div>
                <div class="word-item" data-word="startle">startle</div>
                <div class="word-item" data-word="scenery">scenery</div>
            </div>
            <div class="sentence-area-front" id="sentenceFront"></div>
            <div class="word-detail" id="wordDetail"></div>
        </div>

        <div class="back clearfix" id="backCard">
            <div class="sentence-area-back" id="sentenceBack"></div>
            <div class="speech-controls" id="speechControls">
                <button class="play-btn" id="playSentenceBtn">播放对话发音</button>
                <div>
                    <label for="voiceSelectA">A发音人（优先选Neural/Natural）：</label>
                    <select id="voiceSelectA"></select>
                </div>
                <div>
                    <label for="voiceSelectB">B发音人（优先选Neural/Natural）：</label>
                    <select id="voiceSelectB"></select>
                </div>
                <div>
                    <label for="speedRange">发音速度：</label>
                    <input type="range" id="speedRange" min="0.7" max="1.3" step="0.05" value="0.95">
                    <span id="speedValue">0.95x</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const frontDialogs = [
            "A：I’ve been looking into our <span class='highlight-word'>campus</span> ecosystem lately, and I actually found a rare <span class='highlight-word'>organism</span> near the lake—have you seen anything like that at all?",
            "B：Oh, that’s really fascinating! As someone studying <span class='highlight-word'>journalism</span>, I reckon this discovery could help raise awareness about protecting our local <span class='highlight-word'>scenery</span> and wildlife.",
            "A：Absolutely! Every <span class='highlight-word'>citizen</span> should feel <span class='highlight-word'>accountable</span> for preserving these kinds of treasures, especially since our <span class='highlight-word'>civilization</span> has always been so closely connected to nature.",
            "B：I totally agree. Last week, a group of students tried to get way too close to the lake, and their noise seemed to <span class='highlight-word'>startle</span> some small creatures—we really shouldn’t be putting these <span class='highlight-word'>organism</span>s in <span class='highlight-word'>peril</span> like that.",
            "A：That’s a really good point. I’ve noticed some students have a natural <span class='highlight-word'>aptitude</span> for photography, and they’ve been capturing the <span class='highlight-word'>scenery</span> without disturbing the wildlife at all.",
            "B：You know, maybe we could collaborate with them on a <span class='highlight-word'>journalism</span> project? We could highlight how <span class='highlight-word'>citizen</span>s can protect the <span class='highlight-word'>campus</span> environment while still appreciating its beauty.",
            "A：Oh, what a great idea! It’d also emphasize that we’re all <span class='highlight-word'>accountable</span> for safeguarding not just the <span class='highlight-word'>organism</span>s but also the legacy of our <span class='highlight-word'>civilization</span> here on campus.",
            "B：Exactly! I don’t want to <span class='highlight-word'>startle</span> anyone with alarming facts or anything, but a lot of small <span class='highlight-word'>organism</span>s are already in <span class='highlight-word'>peril</span> because of careless human actions.",
            "A：That’s exactly why this project is so important. The <span class='highlight-word'>campus</span> has such stunning <span class='highlight-word'>scenery</span>, and with the <span class='highlight-word'>aptitude</span> of our peers, we could actually make a real difference through <span class='highlight-word'>journalism</span>.",
            "B：Right, let’s get started then! As <span class='highlight-word'>citizen</span>s of this community, we’ve got a responsibility to make sure our <span class='highlight-word'>civilization</span> grows in harmony with nature, not at the cost of putting other <span class='highlight-word'>organism</span>s in <span class='highlight-word'>peril</span>."
        ];

        const backDialogPairs = [
            { 
                english: "A：I’ve been looking into our campus ecosystem lately, and I actually found a rare organism near the lake—have you seen anything like that at all?", 
                chinese: "A：我最近一直在研究我们校园的生态系统，而且其实我在湖边发现了一种罕见的生物——你到底有没有见过类似的东西？" 
            },
            { 
                english: "B：Oh, that’s really fascinating! As someone studying journalism, I reckon this discovery could help raise awareness about protecting our local scenery and wildlife.", 
                chinese: "B：哦，这太有意思了！作为一名学习新闻专业的人，我觉得这个发现有助于提高人们对保护当地风景和野生动物的意识。" 
            },
            { 
                english: "A：Absolutely! Every citizen should feel accountable for preserving these kinds of treasures, especially since our civilization has always been so closely connected to nature.", 
                chinese: "A：完全没错！每个公民都应该为保护这类宝藏感到责任在肩，尤其是因为我们的文明一直与自然联系得如此紧密。" 
            },
            { 
                english: "B：I totally agree. Last week, a group of students tried to get way too close to the lake, and their noise seemed to startle some small creatures—we really shouldn’t be putting these organisms in peril like that.", 
                chinese: "B：我完全同意。上周有一群学生试图过分靠近湖边，他们的噪音似乎吓到了一些小动物——我们真的不应该这样把这些生物置于危险之中。" 
            },
            { 
                english: "A：That’s a really good point. I’ve noticed some students have a natural aptitude for photography, and they’ve been capturing the scenery without disturbing the wildlife at all.", 
                chinese: "A：你说得太有道理了。我注意到有些学生天生就有摄影天赋，他们一直在捕捉风景的同时，完全没有打扰到野生动物。" 
            },
            { 
                english: "B：You know, maybe we could collaborate with them on a journalism project? We could highlight how citizens can protect the campus environment while still appreciating its beauty.", 
                chinese: "B：你知道吗，或许我们可以和他们合作一个新闻项目？我们可以强调公民如何在依然欣赏校园美景的同时保护校园环境。" 
            },
            { 
                english: "A：Oh, what a great idea! It’d also emphasize that we’re all accountable for safeguarding not just the organisms but also the legacy of our civilization here on campus.", 
                chinese: "A：哦，好主意！这也会强调我们所有人都有责任保护这些生物，以及我们在这个校园里的文明遗产。" 
            },
            { 
                english: "B：Exactly! I don’t want to startle anyone with alarming facts or anything, but a lot of small organisms are already in peril because of careless human actions.", 
                chinese: "B：没错！我不想用令人震惊的事实之类的东西吓到任何人，但很多小型生物已经因为人类的粗心行为而处于危险之中。" 
            },
            { 
                english: "A：That’s exactly why this project is so important. The campus has such stunning scenery, and with the aptitude of our peers, we could actually make a real difference through journalism.", 
                chinese: "A：这正是这个项目如此重要的原因。校园的风景如此迷人，凭借同龄人的天赋，我们实际上可以通过新闻工作产生真正的影响。" 
            },
            { 
                english: "B：Right, let’s get started then! As citizens of this community, we’ve got a responsibility to make sure our civilization grows in harmony with nature, not at the cost of putting other organisms in peril.", 
                chinese: "B：对，那我们现在就开始吧！作为这个社区的公民，我们有责任确保我们的文明与自然和谐发展，而不是以牺牲其他生物的安全为代价。" 
            }
        ];

        const shuffledFront = frontDialogs;
        const shuffledBack = backDialogPairs;

        const sentenceFront = document.getElementById('sentenceFront');
        shuffledFront.forEach((dialog) => {
            const p = document.createElement('p');
            p.className = 'dialog-sentence';
            p.innerHTML = dialog;
            const pureText = p.textContent.replace(/^[AB]：/, '').trim();
            p.dataset.text = pureText;
            sentenceFront.appendChild(p);
        });

        const sentenceBack = document.getElementById('sentenceBack');
        shuffledBack.forEach((pair) => {
            const div = document.createElement('div');
            div.className = 'sentence-pair';
            div.innerHTML = `
                <p class="english">${pair.english}</p>
                <p class="chinese">${pair.chinese}</p>
            `;
            sentenceBack.appendChild(div);
        });

        const wordData = {
            peril: { phonetic: "/ˈperəl/", meanings: "1. 严重危险；祸患", word: "peril" },
            accountable: { phonetic: "/əˈkaʊntəbl/", meanings: "1. 负有责任的；应作解释的", word: "accountable" },
            organism: { phonetic: "/ˈɔːɡənɪzəm/", meanings: "1. 生物；有机体", word: "organism" },
            journalism: { phonetic: "/ˈdʒɜːnəlɪzəm/", meanings: "1. 新闻业；新闻工作", word: "journalism" },
            citizen: { phonetic: "/ˈsɪtɪzn/", meanings: "1. 公民；市民；居民", word: "citizen" },
            civilization: { phonetic: "/ˌsɪvəlaɪˈzeɪʃn/", meanings: "1. 文明；文明社会；文化", word: "civilization" },
            campus: { phonetic: "/ˈkæmpəs/", meanings: "1. （大学）校园；校区", word: "campus" },
            aptitude: { phonetic: "/ˈæptɪtjuːd/", meanings: "1. 天资；天赋；才能", word: "aptitude" },
            startle: { phonetic: "/ˈstɑːtl/", meanings: "1. （使）惊吓；（使）吃惊", word: "startle" },
            scenery: { phonetic: "/ˈsiːnəri/", meanings: "1. 风景；景色；舞台布景", word: "scenery" }
        };

        const toggleBtn = document.getElementById('toggleBtn');
        const frontCard = document.getElementById('frontCard');
        const backCard = document.getElementById('backCard');
        const wordList = document.getElementById('wordList');
        const wordDetail = document.getElementById('wordDetail');
        const playSentenceBtn = document.getElementById('playSentenceBtn');
        const voiceSelectA = document.getElementById('voiceSelectA');
        const voiceSelectB = document.getElementById('voiceSelectB');
        const speedRange = document.getElementById('speedRange');
        const speedValue = document.getElementById('speedValue');

        let voices = [];
        
        // 核心优化：优先筛选「高质量神经语音」，过滤机械基础音
        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
            
            // 1. 分层筛选：先选「神经语音」→ 再选「微软/系统高质量语音」→ 最后选普通英文语音
            const neuralVoices = voices.filter(voice => {
                const name = voice.name.toLowerCase();
                const lang = voice.lang.toLowerCase();
                // 匹配带「neural」「natural」「ai」标识的高质量语音（Windows/macOS的神经语音均有此标识）
                return (name.includes('neural') || name.includes('natural') || name.includes('ai')) && 
                       (lang === 'en-us' || lang === 'en-gb' || lang === 'en-au');
            });

            const highQualityVoices = voices.filter(voice => {
                const name = voice.name.toLowerCase();
                const lang = voice.lang.toLowerCase();
                // 匹配微软原生高质量语音（David/Zira/Jenny等）
                return (name.includes('microsoft') || name.includes('david') || name.includes('zira') || name.includes('jenny')) &&
                       (lang === 'en-us' || lang === 'en-gb' || lang === 'en-au');
            });

            const normalEnglishVoices = voices.filter(voice => {
                const lang = voice.lang.toLowerCase();
                return (lang === 'en-us' || lang === 'en-gb' || lang === 'en-au') &&
                       !neuralVoices.includes(voice) && !highQualityVoices.includes(voice);
            });

            // 合并语音列表：高质量在前，普通在后
            const sortedVoices = [...neuralVoices, ...highQualityVoices, ...normalEnglishVoices];

            // 2. 填充发音人选择框（标注语音类型，方便用户识别）
            voiceSelectA.innerHTML = '';
            voiceSelectB.innerHTML = '';

            if (sortedVoices.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = '无可用高质量英文语音（请安装系统语音包）';
                voiceSelectA.appendChild(option);
                voiceSelectB.appendChild(option);
            } else {
                sortedVoices.forEach(voice => {
                    const isNeural = voice.name.toLowerCase().includes('neural') || voice.name.toLowerCase().includes('natural');
                    const optionText = isNeural ? 
                        `${voice.name} (${voice.lang}) [高质量神经音]` : 
                        `${voice.name} (${voice.lang})`;
                    
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = optionText;

                    // 3. 默认选中第一个神经语音（优先保证高质量体验）
                    if (isNeural && voiceSelectA.options.length === 0) {
                        option.selected = true;
                    }
                    if (isNeural && voiceSelectB.options.length === 0 && voice !== voiceSelectA.selectedOptions[0]?.value) {
                        option.selected = true;
                    }

                    voiceSelectA.appendChild(option.cloneNode(true));
                    voiceSelectB.appendChild(option);
                });
            }
        }

        // 增强兼容性：多触发一次加载（避免浏览器延迟）
        if (typeof window.speechSynthesis !== 'undefined') {
            loadVoices();
            window.speechSynthesis.onvoiceschanged = loadVoices;
            setTimeout(loadVoices, 500); // 延长延迟，确保系统语音库加载完成
        } else {
            voiceSelectA.innerHTML = '<option value="">浏览器不支持语音合成</option>';
            voiceSelectB.innerHTML = '<option value="">浏览器不支持语音合成</option>';
            playSentenceBtn.disabled = true;
            playSentenceBtn.textContent = '浏览器不支持发音功能';
        }

        // 优化语速范围：限制在0.7-1.3x（高质量语音在这个区间最自然，避免过快/过慢失真）
        speedRange.addEventListener('input', () => {
            const speed = speedRange.value;
            speedValue.textContent = `${speed}x`;
        });

        // 单词发音：强制使用高质量语音
        function pronounceWord(word) {
            if (typeof window.speechSynthesis === 'undefined') {
                alert('您的浏览器不支持语音合成功能');
                return;
            }
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.rate = parseFloat(speedRange.value);
            utterance.pitch = 1.05; // 微调音高，更接近自然人声
            utterance.volume = 1;
            utterance.lang = 'en-US';

            // 优先使用神经语音
            const highQualityVoice = voices.find(voice => 
                voice.name.toLowerCase().includes('neural') || voice.name.toLowerCase().includes('natural')
            ) || voices.find(voice => voice.lang.toLowerCase() === 'en-us');
            
            if (highQualityVoice) utterance.voice = highQualityVoice;

            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        // 句子发音：优化自然度参数
        function pronounceSentence(text, voice, speed) {
            if (typeof window.speechSynthesis === 'undefined') {
                alert('您的浏览器不支持语音合成功能');
                return null;
            }
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = voice?.lang || 'en-US';
            utterance.pitch = voice === voiceSelectA.value ? 1.05 : 0.98; // 细微区分两个发音人音色
            utterance.rate = parseFloat(speed);
            utterance.volume = 1;
            utterance.voice = voice;
            
            // 增强自然度：添加轻微停顿（根据句子长度调整）
            const pauseTime = text.length > 50 ? 150 : 100; // 长句多停，短句少停
            utterance.onend = () => {
                setTimeout(() => {}, pauseTime);
            };
            
            return utterance;
        }

        // 正面句子点击发音
        sentenceFront.addEventListener('click', (e) => {
            const dialogSentence = e.target.closest('.dialog-sentence');
            if (!dialogSentence) return;
            const pureText = dialogSentence.dataset.text;
            if (!pureText) return;

            const highQualityVoice = voices.find(voice => 
                voice.name.toLowerCase().includes('neural') || voice.name.toLowerCase().includes('natural')
            );
            const utterance = pronounceSentence(pureText, highQualityVoice, speedRange.value);
            if (utterance) {
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(utterance);
            }
        });

        // 单词点击事件
        wordList.addEventListener('click', (e) => {
            const wordItem = e.target.closest('.word-item');
            if (!wordItem) return;

            const wordKey = wordItem.dataset.word;
            const wordInfo = wordData[wordKey];
            pronounceWord(wordKey);

            if (wordDetail.style.display === 'block' && wordDetail.dataset.current === wordKey) {
                wordDetail.style.display = 'none';
                wordDetail.removeAttribute('data-current');
                return;
            }

            wordDetail.innerHTML = `
                <h3>${wordInfo.word}</h3>
                <div class="phonetic">音标：${wordInfo.phonetic}</div>
                <div class="meanings">释义：${wordInfo.meanings}</div>
                <button class="pronounce-btn" data-word="${wordKey}">点击发音（高质量音色）</button>
            `;
            wordDetail.dataset.current = wordKey;
            wordDetail.style.display = 'block';

            wordDetail.querySelector('.pronounce-btn').addEventListener('click', () => {
                pronounceWord(wordKey);
            });
        });

        // 正反面切换
        let isFront = true;
        toggleBtn.addEventListener('click', () => {
            if (isFront) {
                frontCard.style.display = 'none';
                backCard.style.display = 'block';
                isFront = false;
            } else {
                frontCard.style.display = 'block';
                backCard.style.display = 'none';
                isFront = true;
            }
        });

        // 对话发音播放逻辑（优化流畅度）
        let isPlaying = false;
        let currentUtterances = [];
        let playTimer = null;
        playSentenceBtn.addEventListener('click', () => {
            if (typeof window.speechSynthesis === 'undefined') {
                alert('您的浏览器不支持语音合成功能');
                return;
            }

            if (isPlaying) {
                window.speechSynthesis.cancel();
                if (playTimer) clearTimeout(playTimer);
                playSentenceBtn.textContent = '播放对话发音';
                isPlaying = false;
                currentUtterances = [];
                playTimer = null;
                return;
            }

            const dialogItems = Array.from(sentenceBack.querySelectorAll('.english')).map(el => ({
                text: el.textContent.replace(/^[AB]：/, '').trim(),
                speaker: el.textContent.startsWith('A：') ? 'A' : 'B'
            }));
            
            const selectedVoiceAName = voiceSelectA.value;
            const selectedVoiceBName = voiceSelectB.value;
            const voiceA = voices.find(voice => voice.name === selectedVoiceAName);
            const voiceB = voices.find(voice => voice.name === selectedVoiceBName);

            if (!voiceA || !voiceB) {
                alert('未检测到可用的高质量英文语音，请先安装系统语音包');
                return;
            }
            
            const speed = parseFloat(speedRange.value);
            playSentenceBtn.textContent = '停止对话发音';
            isPlaying = true;

            let currentIndex = 0;
            function playNext() {
                if (currentIndex >= dialogItems.length || !isPlaying) {
                    playSentenceBtn.textContent = '播放对话发音';
                    isPlaying = false;
                    currentUtterances = [];
                    playTimer = null;
                    return;
                }

                const currentItem = dialogItems[currentIndex];
                const targetVoice = currentItem.speaker === 'A' ? voiceA : voiceB;
                const utterance = pronounceSentence(currentItem.text, targetVoice, speed);
                
                currentUtterances.push(utterance);

                utterance.onend = () => {
                    if (!isPlaying) return;
                    const nextSpeaker = currentIndex + 1 < dialogItems.length ? dialogItems[currentIndex + 1].speaker : '';
                    const pauseTime = currentItem.speaker === nextSpeaker ? 300 : 500; // 不同角色停顿更长，更自然
                    
                    playTimer = setTimeout(() => {
                        currentIndex++;
                        playNext();
                    }, pauseTime);
                };

                utterance.onerror = (e) => {
                    console.error('发音播放错误:', e);
                    window.speechSynthesis.cancel();
                    if (playTimer) clearTimeout(playTimer);
                    playSentenceBtn.textContent = '播放对话发音';
                    isPlaying = false;
                    currentUtterances = [];
                    playTimer = null;
                };

                window.speechSynthesis.speak(utterance);
            }

            window.speechSynthesis.cancel();
            if (playTimer) clearTimeout(playTimer);
            playNext();
        });
    </script>
</body>
</html>
