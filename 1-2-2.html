<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iPad语音音色调用</title>
    <style>
        /* 适配iPad的样式，简洁易操作 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
            font-size: 18px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        select, textarea, button {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        button {
            background-color: #0071e3;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #status {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>iPad语音合成</h1>
        <!-- 语音音色选择下拉框 -->
        <div>
            <label for="voiceSelect">选择iPad已下载的语音音色：</label>
            <select id="voiceSelect" disabled>
                <option value="">加载中...</option>
            </select>
        </div>
        <!-- 文本输入框 -->
        <div>
            <label for="textInput">输入要朗读的文本：</label>
            <textarea id="textInput" placeholder="请输入文本...">你好，这是iPad下载的语音音色测试</textarea>
        </div>
        <!-- 控制按钮 -->
        <div>
            <button id="playBtn">播放语音</button>
            <button id="pauseBtn">暂停语音</button>
            <button id="stopBtn">停止语音</button>
        </div>
        <!-- 状态提示 -->
        <div id="status">就绪</div>
    </div>

    <script>
        // 获取DOM元素
        const voiceSelect = document.getElementById('voiceSelect');
        const textInput = document.getElementById('textInput');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');

        // 存储可用的语音列表
        let voices = [];

        // 监听语音列表加载完成事件（关键：iPad的语音列表加载是异步的）
        function loadVoices() {
            voices = window.speechSynthesis.getVoices();
            voiceSelect.innerHTML = ''; // 清空原有选项

            // 遍历所有语音，添加到下拉框
            voices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index; // 用索引标识语音
                // 显示语音名称+语言（方便识别iPad下载的音色）
                option.textContent = `${voice.name} (${voice.lang})`;
                voiceSelect.appendChild(option);
            });

            voiceSelect.disabled = false;
            status.textContent = `已加载 ${voices.length} 个语音音色`;
        }

        // 兼容不同浏览器的事件监听（主要适配Safari）
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }
        // 主动触发一次（防止事件未触发）
        setTimeout(loadVoices, 100);

        // 播放语音
        playBtn.addEventListener('click', () => {
            const text = textInput.value.trim();
            if (!text) {
                status.textContent = '请输入要朗读的文本';
                return;
            }
            if (voices.length === 0) {
                status.textContent = '未检测到可用的语音音色';
                return;
            }

            // 创建语音合成实例
            const utterance = new SpeechSynthesisUtterance(text);
            // 选择下拉框中指定的语音音色
            const selectedVoiceIndex = voiceSelect.value;
            utterance.voice = voices[selectedVoiceIndex];
            // 可选：设置语速、音量、音调（适配iPad）
            utterance.rate = 1; // 语速（0.1-10）
            utterance.volume = 1; // 音量（0-1）
            utterance.pitch = 1; // 音调（0-2）

            // 播放状态监听
            utterance.onstart = () => {
                status.textContent = `正在播放：${voices[selectedVoiceIndex].name}`;
            };
            utterance.onend = () => {
                status.textContent = '播放完成';
            };
            utterance.onerror = (e) => {
                status.textContent = `播放出错：${e.error}`;
            };

            // 开始播放
            window.speechSynthesis.speak(utterance);
        });

        // 暂停语音
        pauseBtn.addEventListener('click', () => {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.pause();
                status.textContent = '已暂停';
            }
        });

        // 停止语音
        stopBtn.addEventListener('click', () => {
            window.speechSynthesis.cancel();
            status.textContent = '已停止';
        });
    </script>
</body>
</html>
